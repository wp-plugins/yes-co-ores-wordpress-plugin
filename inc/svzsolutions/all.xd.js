/**
 * Copyright (c) 2010, SVZ Solutions All Rights Reserved.
 * Available via BSD license, see license file included for details. 
 */
dojo.provide("svzsolutions.all");if(!dojo._hasResource["svzsolutions.generic.Math"]){dojo._hasResource["svzsolutions.generic.Math"]=true;dojo.provide("svzsolutions.generic.Math");dojo.declare("svzsolutions.generic.Math",null,{MILES_TO_KILOMETRES_EQUATION:1.609344,constructor:function(){},roundNumber:function(_1,_2){if(isNaN(_2)||_2<1){_2=0;}var _3=Math.pow(10,_2);var _4=Math.round(_1*_3)/_3;return _4;},metresToKilometres:function(_5){var _6=_5/1000;return _6;},metresToMiles:function(_7){var _8=this.metresToKilometres(_7);var _9=this.kilometresToMiles(_8);return _9;},kilometresToMiles:function(_a){var _b=_a/this.MILES_TO_KILOMETRES_EQUATION;return _b;},milesToKilometres:function(_c){var _d=_c*this.MILES_TO_KILOMETRES_EQUATION;return _d;}});}if(!dojo._hasResource["svzsolutions.maps.MapManager"]){dojo._hasResource["svzsolutions.maps.MapManager"]=true;dojo.provide("svzsolutions.maps.MapManager");dojo.declare("svzsolutions.maps.MapManager",null,{constructor:function(){this._maps=[];this._googleMapsLibraryLoaded=false;this._googleMapsLibraryRequested=false;this._googleMapsConfigs=[];this._mapIndex=-1;if(svzsolutions.global&&svzsolutions.global.mapManager&&google&&google.maps){this._googleMapsLibraryLoaded=true;}if(!svzsolutions.global){svzsolutions.global=new Object();}svzsolutions.global.mapManager=this;dojo.addOnUnload(dojo.hitch(this,this.destroy));},getByIndex:function(_e){if(_e<0){console.error("MapManager getByIndex: No map index provided.");return false;}if(!this._maps[_e]){console.error("MapManager getByIndex: Could not find a map with index: [",_e,"]");return false;}return this._maps[_e];},initByConfig:function(_f){if(!_f){return false;}var _10=dojo.fromJson(_f);console.log("MapManager: Adding and initializing config: ",_10);if(_10.libraryConfig){switch(_10.libraryConfig.name){case "googlemaps":this._mapIndex++;var map=new svzsolutions.maps.googlemaps.Map(_10);map.index=this._mapIndex;this._maps[this._mapIndex]=map;return this._maps[this._mapIndex];break;}}return false;},destroyByIndex:function(_11){console.log("MapManager: Trying to destroy the map by mapIndex",_11);var map=this.getByIndex(_11);map.destroy();},destroy:function(){if(this._maps){for(var i=0;i<this._maps.length;i++){this._maps[i].destroy();}}this._maps=null;this._googleMapsConfigs=null;this._maps=[];this._googleMapsConfigs=[];this._mapIndex=-1;},startup:function(){for(var i=0;i<this._maps.length;i++){var _12=null;if(_12=this._maps[i].getConfig()){if(_12.libraryConfig){switch(_12.libraryConfig.name){case "googlemaps":this._loadGoogleMapsLibrary(_12);break;}}}}},_loadGoogleMapsLibrary:function(_13){if(!this._googleMapsLibraryLoaded){this._loadGoogleMaps(_13);}else{this._loadGoogleBasedMaps(_13);}},_loadGoogleMaps:function(_14){this._googleMapsConfigs.push(_14);if(!this._googleMapsLibraryRequested){this._googleMapsLibraryRequested=true;var _15=document.createElement("script");_15.src="http://maps.google.com/maps/api/js?sensor=false&callback=svzsolutions.global.mapManager._loadGoogleMapsCallback";_15.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(_15);}},_loadGoogleMapsCallback:function(){this._googleMapsLibraryLoaded=true;this._loadGoogleBasedMaps();},_loadGoogleBasedMaps:function(){if(this._maps){for(var i=0;i<this._maps.length;i++){if(!this._maps[i].isLoaded()){this._maps[i].load();}}}}});}if(!dojo._hasResource["svzsolutions.generic.Loader"]){dojo._hasResource["svzsolutions.generic.Loader"]=true;dojo.provide("svzsolutions.generic.Loader");dojo.declare("svzsolutions.generic.Loader",null,{LOADER_UNDERLAY_HOLDER_CLASS:"sg-loader-underlay-holder",LOADER_HOLDER_CLASS:"sg-loader-holder",LOADER_CANCEL_ELEM_CLASS:"sg-loader-cancel",DEFAULT_CANCEL_DELAY:3000,constructor:function(_16,_17,_18,_19){if(!_19){_19={};}this._config=_19;loaderUnderlayHolderClassName=this.LOADER_UNDERLAY_HOLDER_CLASS;loaderHolderClassName=this.LOADER_HOLDER_CLASS;this._cancelDelayHandler=null;if(_16){loaderUnderlayHolderClassName+=" sg-"+_16+"-underlay-holder";loaderHolderClassName+=" sg-"+_16+"-holder";}this._underlayElem=dojo.create("div",{className:loaderUnderlayHolderClassName});this._elem=dojo.create("div",{className:loaderHolderClassName});if(_17){this.placeAt(_17,_18);}},_onCancel:function(_1a){dojo.stopEvent(_1a);this.hide();this.onCancel(_1a);},_showCancelElem:function(){if(this._cancelElem){dojo.style(this._cancelElem,"display","block");}else{var _1b="Cancel";if(this._config.textCancel){_1b=this._config.textCancel;}this._cancelElem=dojo.create("a",{className:this.LOADER_CANCEL_ELEM_CLASS,innerHTML:_1b,href:"#"},this._elem);this._cancelHandle=dojo.connect(this._cancelElem,"onclick",this,"_onCancel");}},onCancel:function(_1c){},show:function(){dojo.style(this._elem,"display","block");dojo.style(this._underlayElem,"display","block");var _1d=dojo.hitch(this,function(){this._showCancelElem();});if(this._config.showCancelDelay||this._config.showCancelDelay>=0){this._cancelDelayHandler=window.setTimeout(_1d,this._config.showCancelDelay);}else{this._cancelDelayHandler=window.setTimeout(_1d,this.DEFAULT_CANCEL_DELAY);}},hide:function(){if(this._cancelDelayHandler){window.clearTimeout(this._cancelDelayHandler);}if(this._cancelElem){dojo.style(this._cancelElem,"display","none");}dojo.style(this._elem,"display","none");dojo.style(this._underlayElem,"display","none");},placeAt:function(_1e,_1f){dojo.place(this._underlayElem,_1e,_1f);dojo.place(this._elem,_1e,_1f);},destroy:function(){if(this._cancelDelayHandler){window.clearTimeout(this._cancelDelayHandler);}dojo.destroy(this._elem);dojo.destroy(this._underlayElem);if(this._cancelHandle){dojo.disconnect(this._cancelHandle);}return true;}});}if(!dojo._hasResource["svzsolutions.generic.RequestManager"]){dojo._hasResource["svzsolutions.generic.RequestManager"]=true;dojo.provide("svzsolutions.generic.RequestManager");dojo.declare("svzsolutions.generic.RequestManager",null,{constructor:function(){this._requests=[];},get:function(_20,_21){if(!_21||!_20){return;}this.cancel(_21);return (this._requests[_21]=dojo.xhrGet(_20));},cancel:function(_22){if(!_22){return;}if(this._requests[_22]){this._requests[_22].cancel();}}});}if(!dojo._hasResource["svzsolutions.generic.MarkerManager"]){dojo._hasResource["svzsolutions.generic.MarkerManager"]=true;dojo.provide("svzsolutions.generic.MarkerManager");dojo.declare("svzsolutions.generic.MarkerManager",null,{constructor:function(){this._fixedLayers=[];this._dynamicLayers=[];},add:function(_23){if(_23&&_23.type&&_23.type.layerName&&_23.type.layerType){var _24=_23.type.layerName;var _25=_23.type.layerType;switch(_25){case "fixed":if(!this._fixedLayers[_24]){this._fixedLayers[_24]=[];}this._fixedLayers[_24].push(_23);break;case "dynamic":if(!this._dynamicLayers[_24]){this._dynamicLayers[_24]=[];}this._dynamicLayers[_24].push(_23);break;}}else{console.error("MarkerManager: could not add marker to markerManager, no layerName or layerType provided.");}},getByType:function(_26){var _27=[];if(!_26){return _27;}_27=this.getDynamicByType(_26);_27=dojo.mixin(this.getFixedByType(_26));return _27;},getDynamic:function(){var _28=[];for(var key in this._dynamicLayers){for(var i=0;i<this._dynamicLayers[key].length;i++){var _29=this._dynamicLayers[key][i];_28.push(_29);}}return _28;},getDynamicByType:function(_2a){var _2b=[];if(!_2a){return _2b;}for(var key in this._dynamicLayers){for(var i=0;i<this._dynamicLayers[key].length;i++){var _2c=this._dynamicLayers[key][i];if(_2c.typeName==_2a){_2b.push(_2c);}}}return _2b;},getFixed:function(){var _2d=[];for(var key in this._fixedLayers){for(var i=0;i<this._fixedLayers[key].length;i++){var _2e=this._fixedLayers[key][i];_2d.push(_2e);}}return _2d;},getFixedByType:function(_2f){var _30=[];if(!_2f){return _30;}for(var key in this._fixedLayers){for(var i=0;i<this._fixedLayers[key].length;i++){var _31=this._fixedLayers[key][i];if(_31.typeName==_2f){_30.push(_31);}}}return _30;},clearDynamicMarkersFromMap:function(){for(var key in this._dynamicLayers){console.log("MarkerManager: current number of markers in layer [",key,"] is [",this._dynamicLayers[key].length,"]");while(marker=this._dynamicLayers[key].pop()){marker.setMap(null);}}},clearFixedMarkersFromMap:function(){for(var key in this._fixedLayers){console.log("MarkerManager: current number of markers in layer [",key,"] is [",this._fixedLayers[key].length,"]");while(marker=this._fixedLayers[key].pop()){marker.setMap(null);}}}});}if(!dojo._hasResource["svzsolutions.maps.googlemaps.Map"]){dojo._hasResource["svzsolutions.maps.googlemaps.Map"]=true;dojo.provide("svzsolutions.maps.googlemaps.Map");dojo.declare("svzsolutions.maps.googlemaps.Map",null,{INFO_WINDOW_CONTENT_CLASS:"info-window-content",constructor:function(_32){this._config=_32;this._map=null;this._markerManager=new svzsolutions.generic.MarkerManager();this._requestManager=new svzsolutions.generic.RequestManager();this._loadDataForm=null;this._loader=null;this._loaderInfoWindow=null;this._loaded=false;},setLoadDataOnce:function(_33){if(_33){this._config.loadDataOnce=true;}else{this._config.loadDataOnce=false;}this._dataLoaded=false;},getConfig:function(){return this._config;},load:function(){this._infoWindow=new google.maps.InfoWindow();var _34={};_34.center=new google.maps.LatLng(this._config.centerGeoLat,this._config.centerGeoLng);_34.zoom=this._config.zoomLevel;_34.mapTypeId=this._config.mapType;_34.mapTypeControl=this._config.mapTypeControl;if(this._config.enableStreetViewControl){_34.streetViewControl=this._config.enableStreetViewControl;}if(this._config.mapTypeControlOptions){var _35={};_35.position=dojo.getObject(this._config.mapTypeControlOptions.position);_35.style=dojo.getObject(this._config.mapTypeControlOptions.style);_34.mapTypeControlOptions=_35;}_34.navigationControl=this._config.navigationControl;if(this._config.navigationControlOptions){var _36={};_36.position=dojo.getObject(this._config.navigationControlOptions.position);_36.style=dojo.getObject(this._config.navigationControlOptions.style);_34.navigationControlOptions=_36;}_34.scaleControl=this._config.scaleControl;if(this._config.scaleControlOptions){var _37={};_37.position=dojo.getObject(this._config.scaleControlOptions.position);_37.style=dojo.getObject(this._config.scaleControlOptions.style);_34.scaleControlOptions=_37;}console.log("Generated the following Google Maps config [",_34,"]");this._map=new google.maps.Map(dojo.byId(this._config.mapContainerId),_34);if(navigator.userAgent.indexOf("iPhone")!=-1||navigator.userAgent.indexOf("Android")!=-1){dojo.style(this.getMapContainer(),"width","100%");dojo.style(this.getMapContainer(),"height","100%");}if(this._config.layers){for(var i=0;i<this._config.layers.length;i++){var _38=new google.maps.Layer(this._config.layers[i]);this.getMap().addOverlay(_38);}}google.maps.event.addListener(this.getMap(),"idle",dojo.hitch(this,this.onIdle));google.maps.event.addListener(this.getMap(),"zoom_changed",dojo.hitch(this,this.onZoomLevelChanged));google.maps.event.addListener(this.getMap(),"dragend",dojo.hitch(this,this.onDragend));google.maps.event.addListener(this.getMap(),"center_changed",dojo.hitch(this,this.onCenterChanged));if(this._config.markers){var _39={};_39.markers=this._config.markers;this.processMarkers(_39.markers);}this._loaded=true;this.onMapLoaded();},isLoaded:function(){return this._loaded;},onMapLoaded:function(){},onCenterChanged:function(){},getMap:function(){return this._map;},getMapContainer:function(){return this.getMap().getDiv();},onIdle:function(_3a){this.loadData();},onZoomLevelChanged:function(_3b){this._infoWindow.close();},onDragend:function(_3c){this._infoWindow.close();},_onMarkerDragEnd:function(_3d){this.instance.onMarkerDragEnd(this.marker);},onMarkerDragEnd:function(_3e){},_onMarkerClick:function(_3f){var _40=this._infoWindow.dataLoadUrl;if(_40){var _41={url:_40,handleAs:"json",load:dojo.hitch(this,"_loadInfoWindowCallback"),error:dojo.hitch(this,function(_42){if(this._loaderInfoWindow){this._loaderInfoWindow.destroy();this._loaderInfoWindow=null;}if(_42.dojoType=="cancel"){return;}var _43=dojo.create("div",{className:"sg-message-holder sg-error"});var _44=dojo.create("p",{},_43);_44.innerHTML="An error occured trying to load the content, please try again.";this._infoWindow.setContent(_43);console.error("MarkerClick: An unexpected error occurred: ",_42);})};this._requestManager.get(_41,"loadInfoWindowData");}},_loadInfoWindowCallback:function(_45){console.log("InfoWindowCallback");if(this._loaderInfoWindow){this._loaderInfoWindow.destroy();this._loaderInfoWindow=null;}if(_45&&typeof (_45)=="object"){if(_45.content){var _46=dojo._toDom(_45.content);this._infoWindow.setContent(_46);var _47=dojo.hitch(this,function(){this._infoWindow.open(this.getMap(),this.markerClicked);var _48=new svzsolutions.maps.googlemaps.InfoWindow(this._infoWindow.getContent());_48.setMarker(this._infoWindow._marker);this.onInfoWindowContentLoaded(_48);dojo.connect(_48,"initCustomTabContent",this,function(){this.onInfoWindowTabContentLoaded(_48);});});setTimeout(_47,1);}}},onInfoWindowContentLoaded:function(_49){},onInfoWindowTabContentLoaded:function(_4a){},isMarkerInViewPort:function(_4b){if(_4b){var _4c=_4b.getPosition();var _4d=this.getMap().getBounds();return _4d.contains(_4c);}return false;},getZoomLevel:function(){return this.getMap().getZoom();},getViewPortInfo:function(){var _4e=this.getMap().getBounds();var _4f=_4e.getSouthWest();var _50=_4e.getNorthEast();var _51=this.getMap().getZoom();var _52=this.getMap().getCenter();var _53={zoom:_51,sw_lat:_4f.lat(),sw_lng:_4f.lng(),ne_lat:_50.lat(),ne_lng:_50.lng(),ce_lat:_52.lat(),ce_lng:_52.lng(),w:this.getConfig().width,h:this.getConfig().height};return _53;},setLoadDataForm:function(_54){this._loadDataForm=_54;},loadData:function(){console.log("Map: loading data, with option loadDataOnce [",this._config.loadDataOnce,"] / dataLoaded [",this._dataLoaded,"] and dataLoadUrl [",this._config.dataLoadUrl,"]");if(this._config.loadDataOnce&&this._dataLoaded){return;}var _55=this.getViewPortInfo();if(this._config.dataLoadUrl){var _56={url:this._config.dataLoadUrl,failOk:true,content:_55,form:this._loadDataForm,handleAs:"json",load:dojo.hitch(this,this.loadDataCallback),error:function(_57){this._loader.hide();if(_57.dojoType=="cancel"){return;}console.log("An unexpected error occurred: "+_57);}};if(!this._loader){var _58=this.getMap().getDiv().childNodes[0];this._loader=new svzsolutions.generic.Loader("load-data",_58,"first");this._loader.onCancel=dojo.hitch(this,function(_59){this._requestManager.cancel("loadData"+this._config.mapIndex);});}this._loader.show();this._requestManager.get(_56,"loadData"+this._config.mapIndex);}},processMarkers:function(_5a){for(var i=0;i<_5a.length;i++){var _5b=_5a[i];if(!this._config.markerTypes[_5b.type]){console.error("The marker type called \""+_5b.type+"\" seems to be not registered.");continue;}else{try{var _5c=this._config.markerTypes[_5b.type];_5b.markerType=_5c;var _5d=false;var _5e=false;if(_5b.type=="cluster"){var _5f=new svzsolutions.generic.MarkerCluster(_5b,this.getMap());_5e=_5f.getConfig("googlemaps");_5d=new svzsolutions.maps.googlemaps.CustomOverlay(_5e);}else{if(_5b.type=="list"){var _5f=new svzsolutions.generic.MarkerList(_5b,this.getMap());_5e=_5f.getConfig("googlemaps");_5d=new svzsolutions.maps.googlemaps.CustomOverlay(_5e);}else{var _5f=new svzsolutions.generic.Marker(_5b,this.getMap());_5e=_5f.getConfig("googlemaps");if(_5c.iconEnabled){if(_5c.icon){_5e.icon=new google.maps.MarkerImage(_5c.icon.url,new google.maps.Size(_5c.icon.size.width,_5c.icon.size.height));}if(_5c.shadow){_5e.shadow=new google.maps.MarkerImage(_5c.shadow.url,new google.maps.Size(_5c.shadow.size.width,_5c.shadow.size.height));}_5d=new google.maps.Marker(_5e);}else{_5e.className=_5c.className;_5e.typeConfig=_5c;_5e.label=_5b.label;_5d=new svzsolutions.maps.googlemaps.CustomOverlay(_5e);}}}_5d.type=_5c;_5d.typeName=_5b.type;if(_5b.entityId){_5d.entityId=_5b.entityId;}if(_5b.draggable){var _60={};_60.instance=this;_60.marker=_5d;google.maps.event.addListener(_5d,"dragend",dojo.hitch(_60,this._onMarkerDragEnd));}this.bindMarker(_5d,_5b.content,_5e.dataLoadUrl,_5f);this._markerManager.add(_5d);}catch(e){console.error("SvzMaps: loading marker failed [",e,"]");}}}},loadDataCallback:function(_61){console.log("Map: load DataCallback fired with data [",_61,"]");if(this._loader){this._loader.hide();}this._markerManager.clearDynamicMarkersFromMap();if(!this._config.markerTypes){console.error("No marker types seems to be registered.");return;}this._dataLoaded=true;if(_61&&typeof (_61)=="object"){if(_61.markers){this.processMarkers(_61.markers);}}console.log("Map: finished processing of returned data.");},bindMarker:function(_62,_63,_64,_65){if(_62.type.clickAction=="zoom"){var _66=function(){var _67=0;if(_62._config.smartNavigation&&_62._config.smartNavigation.zoomToLevel){_67=_62._config.smartNavigation.zoomToLevel;}else{_67=this.getMap().getZoom()+1;}this.getMap().setCenter(_62._config.position);this.getMap().setZoom(_67);};if(_62.declaredClass&&_62.declaredClass=="svzsolutions.maps.googlemaps.CustomOverlay"){dojo.connect(_62,"onClick",dojo.hitch(this,_66));}else{google.maps.event.addListener(_62,"click",dojo.hitch(this,_66));}}else{var _68=function(){if(_64){var _69=dojo.create("div",{className:this.INFO_WINDOW_CONTENT_CLASS});this._infoWindow.setContent(_69);this._infoWindow._marker=_65;if(!this._loaderInfoWindow){this._loaderInfoWindow=new svzsolutions.generic.Loader("load-info-window-data",_69,"first");this._loaderInfoWindow.onCancel=dojo.hitch(this,function(_6a){this._requestManager.cancel("loadInfoWindowData");this._infoWindow.close();});}this._infoWindow.dataLoadUrl=_64;if(_62._googleOverlay){this.markerClicked=_62._googleOverlay;this._infoWindow.open(this.getMap(),_62._googleOverlay);}else{this.markerClicked=_62;this._infoWindow.open(this.getMap(),_62);}}else{if(_63){this._infoWindow.setContent(_63);this._infoWindow.open(this.getMap(),_62);var _6b=new svzsolutions.maps.googlemaps.InfoWindow(this._infoWindow.getContent());_6b.setMarker(_65);}}};if(_62.declaredClass&&_62.declaredClass=="svzsolutions.maps.googlemaps.CustomOverlay"){dojo.connect(_62,"onClick",dojo.hitch(this,_68));if(_64){dojo.connect(_62,"onClick",this,"_onMarkerClick");}}else{google.maps.event.addListener(_62,"click",dojo.hitch(this,_68));if(_64){google.maps.event.addListener(_62,"click",dojo.hitch(this,this._onMarkerClick));}}}},getMarkerManager:function(){return this._markerManager;},resize:function(_6c){console.log("Map: firing resize ");google.maps.event.trigger(this.getMap(),"resize");if(!_6c){var _6d=new google.maps.LatLng(this._config.centerGeoLat,this._config.centerGeoLng);this.getMap().setCenter(_6d);}},destroy:function(){this._markerManager.clearDynamicMarkersFromMap();this._markerManager.clearFixedMarkersFromMap();this._markerManager=null;if(this.getMap().getDiv()){dojo.destroy(this.getMap().getDiv());}this._requestManager.cancel("loadData"+this._config.mapIndex);}});}if(!dojo._hasResource["svzsolutions.maps.googlemaps.CustomOverlay"]){dojo._hasResource["svzsolutions.maps.googlemaps.CustomOverlay"]=true;dojo.provide("svzsolutions.maps.googlemaps.CustomOverlay");dojo.declare("svzsolutions.maps.googlemaps.CustomOverlay",null,{constructor:function(_6e){this._googleOverlay=new google.maps.OverlayView();this._googleOverlay.draw=this._draw;this._googleOverlay.remove=this._remove;this._googleOverlay.getPosition=this._getPosition;this._googleOverlay._config=_6e;this._config=_6e;this._googleOverlay.latlng_=_6e.position;google.maps.event.addListener(this._googleOverlay,"click",dojo.hitch(this,"onClick"));this.setMap(_6e.map);},setMap:function(map){this._googleOverlay.setMap(map);},onClick:function(_6f){},_draw:function(){var _70=this.div_;if(!_70){_70=this.div_=dojo.create("div",{className:this._config.className,title:this._config.title});if(this._config.label&&this._config.label!="undefined"){dojo.create("div",{className:"sg-label",innerHTML:this._config.label},_70);}google.maps.event.addDomListener(_70,"click",dojo.hitch(this,function(_71){google.maps.event.trigger(this,"click");}));var _72=this.getPanes();_72.overlayImage.appendChild(_70);}var _73=this.getProjection().fromLatLngToDivPixel(this.getPosition());if(_73){var _74=0;var _75=0;if(this._config.typeConfig.autoCenter){_74=(_70.clientWidth/2);_75=(_70.clientHeight/2);}else{if(this._config.typeConfig.autoCenterY){_74=_70.clientWidth;_75=(_70.clientHeight/2);}else{if(this._config.typeConfig.autoCenterX){_74=(_70.clientWidth/2);_75=_70.clientHeight;}else{_74=this._config.typeConfig.correctionX;_75=this._config.typeConfig.correctionY;}}}_70.style.left=(_73.x-_74)+"px";_70.style.top=(_73.y-_75)+"px";}dojo.style(_70,"position","absolute");},remove:function(){if(this._googleOverlay.div_){dojo.destroy(this._googleOverlay.div_);}},_remove:function(){if(this.div_){dojo.destroy(this.div_);}},setPosition:function(_76){console.log("Setting a new position");this._googleOverlay.setPosition(_76);},getPosition:function(){return this._googleOverlay.getPosition();},_getPosition:function(){return this.latlng_;}});}if(!dojo._hasResource["svzsolutions.maps.googlemaps.InfoWindow"]){dojo._hasResource["svzsolutions.maps.googlemaps.InfoWindow"]=true;dojo.provide("svzsolutions.maps.googlemaps.InfoWindow");dojo.declare("svzsolutions.maps.googlemaps.InfoWindow",null,{COMPONENT_TAB_HOLDER_CLASSNAME:"sg-component-tabs-holder",COMPONENT_TAB_LINKS_HOLDER_CLASSNAME:"sg-component-tab-links-holder",COMPONENT_TAB_LINK_LOAD_DYNAMIC_CLASSNAME:"sg-component-tab-link-load-dynamic",COMPONENT_TAB_CONTENTS_HOLDER_CLASSNAME:"sg-component-tab-contents-holder",COMPONENT_TAB_CONTENT_HOLDER_CLASSNAME:"sg-component-tab-content-holder",COMPONENT_LIST_HOLDER_CLASSNAME:"sg-component-list-holder",COMPONENT_LIST_ITEM_HOLDER_CLASSNAME:"sg-component-list-item-holder",MAIN_HOLDER_CLASSNAME:"sg-info-window-content-main-holder",_tabContent:false,_tabLinks:false,constructor:function(_77){console.log("InfoWindow: Constructor");this._tabLinks=false;this._tabContent=false;this._loader=false;this._loaderTab=false;this.mainHolder=false;this.content=_77;this._requestManager=new svzsolutions.generic.RequestManager();this._currentTabContent=false;this._marker=false;var _78=dojo.query("."+this.MAIN_HOLDER_CLASSNAME,_77);if(_78&&_78[0]){this.mainHolder=_78[0];}this.init();},getElem:function(){return this.content;},init:function(){console.log("InfoWindow: Init");var _79=dojo.query("."+this.COMPONENT_TAB_HOLDER_CLASSNAME,this.content);if(_79&&_79[0]){this.initTabComponent(_79[0]);}var _7a=dojo.query("."+this.COMPONENT_LIST_HOLDER_CLASSNAME,this.content);if(_7a&&_7a[0]){this.initListComponent(_7a[0]);}this.initCustomContent();},initTabComponent:function(_7b){this._tabLinks=dojo.query("."+this.COMPONENT_TAB_LINKS_HOLDER_CLASSNAME+" a",_7b);this._tabContent=dojo.query("."+this.COMPONENT_TAB_CONTENTS_HOLDER_CLASSNAME+" ."+this.COMPONENT_TAB_CONTENT_HOLDER_CLASSNAME,_7b);for(var i=0;i<this._tabLinks.length;i++){this._tabLinks[i].linkIndex=i;dojo.connect(this._tabLinks[i],"onclick",this,function(_7c){dojo.stopEvent(_7c);if(_7c.target){this.activateTab(_7c.target.linkIndex);}});}},initListComponent:function(_7d){this.listLinks=dojo.query("."+this.COMPONENT_LIST_ITEM_HOLDER_CLASSNAME+" a",_7d);for(var i=0;i<this.listLinks.length;i++){dojo.connect(this.listLinks[i],"onclick",this,function(_7e){dojo.stopEvent(_7e);var _7f=dojo.attr(_7e.target,"href");this.loadData(_7f);});}},initCustomContent:function(){},initCustomTabContent:function(){},activateTab:function(_80){console.log("InfoWindow: activating tab with index [",_80,"]");var _81="";var _82=false;for(var i=0;i<this._tabLinks.length;i++){dojo.removeClass(this._tabLinks[i],"active");if(i==_80){dojo.addClass(this._tabLinks[i],"active");_81=dojo.attr(this._tabLinks[i],"href");if(dojo.hasClass(this._tabLinks[i],this.COMPONENT_TAB_LINK_LOAD_DYNAMIC_CLASSNAME)){_82=true;}}}for(var i=0;i<this._tabContent.length;i++){dojo.removeClass(this._tabContent[i],"active");if(i==_80){dojo.addClass(this._tabContent[i],"active");this._currentTabContent=this._tabContent[i];}}if(_82){this.loadTabData(_81);}else{this._requestManager.cancel("infoWindowLoadTabData");}},loadData:function(_83){if(!_83){return false;}var _84={url:_83,handleAs:"json",load:dojo.hitch(this,this.loadDataCallback),error:dojo.hitch(this,function(_85){this._loader.destroy();this._loader=null;if(_85.dojoType=="cancel"){return;}console.log("An unexpected error occurred: "+_85);})};this._loader=new svzsolutions.generic.Loader("infowindow-load-data");this._loader.onCancel=dojo.hitch(this,function(_86){this._requestManager.cancel("infoWindowLoadData");});this._loader.placeAt(this.mainHolder,"first");this._loader.show();this._requestManager.get(_84,"infoWindowLoadData");},loadDataCallback:function(_87){if(this.mainHolder){if(_87&&_87.content){var _88=dojo._toDom(_87.content);dojo.place(_88,this.mainHolder,"only");this.initTabComponent(_88);this.initCustomContent();}}},loadTabData:function(_89){console.log("InfoWindow: load tab data from url [",_89,"]");if(!_89){return false;}var _8a={url:_89,handleAs:"json",load:dojo.hitch(this,this.loadTabDataCallback),error:dojo.hitch(this,function(_8b){if(this._loaderTab){this._loaderTab.destroy();this._loaderTab=null;}if(_8b.dojoType=="cancel"){return;}console.log("An unexpected error occurred: "+_8b);})};if(!this._loaderTab){this._loaderTab=new svzsolutions.generic.Loader("infowindow-load-tab-data",this._currentTabContent,"first");this._loaderTab.onCancel=dojo.hitch(this,function(_8c){this._requestManager.cancel("infoWindowLoadTabData");});}this._loaderTab.show();this._requestManager.get(_8a,"infoWindowLoadTabData");},loadTabDataCallback:function(_8d){if(this._currentTabContent){if(_8d&&_8d.content){var _8e=dojo._toDom(_8d.content);dojo.place(_8e,this._currentTabContent,"only");this.initCustomTabContent();}}this._loaderTab.destroy();this._loaderTab=null;},setMarker:function(_8f){console.log("InfoWindow: setting marker to [",_8f,"]");this._marker=_8f;},getMarker:function(){return this._marker;}});}if(!dojo._hasResource["svzsolutions.maps.googlemaps.Address"]){dojo._hasResource["svzsolutions.maps.googlemaps.Address"]=true;dojo.provide("svzsolutions.maps.googlemaps.Address");dojo.declare("svzsolutions.maps.googlemaps.Address",null,{constructor:function(_90){this._address=_90;this._geocoder=new google.maps.Geocoder();},findGeocode:function(){var _91={"address":this._address};this._geocoder.geocode(_91,dojo.hitch(this,"onGeocodeResult"));},onGeocodeResult:function(_92,_93){}});}if(!dojo._hasResource["svzsolutions.generic.Marker"]){dojo._hasResource["svzsolutions.generic.Marker"]=true;dojo.provide("svzsolutions.generic.Marker");dojo.declare("svzsolutions.generic.Marker",null,{constructor:function(_94,map){this._config=_94;this._map=map;},_getConfig:function(_95){if(_95=="googlemaps"){var _96=new google.maps.LatLng(parseFloat(this._config.geoLat),parseFloat(this._config.geoLng));var _97={};_97.map=this._map;_97.position=_96;_97.title=this._config.title;_97.draggable=this._config.draggable;_97.dataLoadUrl=this._config.dataLoadUrl;return _97;}},getConfig:function(_98){return this._getConfig(_98);},getEntityId:function(){return this._config.entityId;}});}if(!dojo._hasResource["svzsolutions.generic.MarkerCluster"]){dojo._hasResource["svzsolutions.generic.MarkerCluster"]=true;dojo.provide("svzsolutions.generic.MarkerCluster");dojo.declare("svzsolutions.generic.MarkerCluster",svzsolutions.generic.Marker,{constructor:function(){},getConfig:function(_99){var _9a=this._getConfig(_99);var _9b=new String(this._config.count);_9a.className=this._config.markerType.className;if(_9b.length<5){_9a.className+=" sg-marker-cluster-size-"+_9b.length;}else{_9a.className+=" sg-marker-cluster-size-5";}_9a.typeConfig=this._config.markerType;_9a.smartNavigation=this._config.smartNavigation;_9a.bounds=this._config.bounds;_9a.label=this._config.label;_9a.closestsMarkers=this._config.closestsMarkers;return _9a;}});}if(!dojo._hasResource["svzsolutions.generic.MarkerList"]){dojo._hasResource["svzsolutions.generic.MarkerList"]=true;dojo.provide("svzsolutions.generic.MarkerList");dojo.declare("svzsolutions.generic.MarkerList",svzsolutions.generic.MarkerCluster,{constructor:function(){},getConfig:function(_9c){var _9d=this._getConfig(_9c);var _9e=new String(this._config.count);_9d.className=this._config.markerType.className;if(_9e.length<5){_9d.className+=" sg-marker-list-size-"+_9e.length;}else{_9d.className+=" sg-marker-list-size-5";}_9d.typeConfig=this._config.markerType;_9d.label=this._config.label;_9d.entityIds=this._config.entityIds;_9d.closestsMarkers=this._config.closestsMarkers;this._config.dataLoadUrl+="?entityIds=";if(this._config.entityIds.length>0){for(var j=0;j<this._config.entityIds.length;j++){this._config.dataLoadUrl+=this._config.entityIds[j]+",";}this._config.dataLoadUrl=this._config.dataLoadUrl.replace(/,$/,"");}_9d.dataLoadUrl=this._config.dataLoadUrl;return _9d;}});}if(!dojo._hasResource["svzsolutions.generic.Geocode"]){dojo._hasResource["svzsolutions.generic.Geocode"]=true;dojo.provide("svzsolutions.generic.Geocode");dojo.declare("svzsolutions.generic.Geocode",null,{DMS_DEG_SIGN_UTF8:"°",DMS_MIN_SIGN_UTF8:"′",DMS_SEC_SIGN_UTF8:"″",constructor:function(_9f,_a0){this._latitude=_9f;this._longitude=_a0;},isValid:function(){if(this.isValidLatitude()&&this.isValidLongitude()){return true;}return false;},isValidLatitude:function(){if(isNaN(this._latitude)){return false;}if(this._latitude>=-90&&this._latitude<=90){return true;}return false;},isValidLongitude:function(){if(isNaN(this._longitude)){return false;}if(this._longitude>=-180&&this._longitude<=180){return true;}return false;},toDMS:function(_a1){if(_a1==""){return false;}dms=new Array();parts=_a1.toString().split(".");dms["degree"]=parts[0];dmsRemainder=("0."+parts[1])*60;dmsRemainderParts=dmsRemainder.toString().split(".");dms["minutes"]=dmsRemainderParts[0];dmsRemainder=("0."+dmsRemainderParts[1])*60;dms["seconds"]=Math.round(dmsRemainder);return dms;},getLatitudeInDMS:function(_a2){if(!_a2){_a2="%deg%%deg-sign% %min%%min-sign% %sec%%sec-sign% %car-dir%";}var _a3="N";if(this._latitude.toString().substr(0,1)=="-"){_a3="S";}var _a4=this.toDMS(this._latitude);dms=_a2.replace("%deg%",_a4["degree"]);dms=dms.replace("%deg-sign%",this.DMS_DEG_SIGN_UTF8);dms=dms.replace("%min%",_a4["minutes"]);dms=dms.replace("%min-sign%",this.DMS_MIN_SIGN_UTF8);dms=dms.replace("%sec%",_a4["seconds"]);dms=dms.replace("%sec-sign%",this.DMS_SEC_SIGN_UTF8);dms=dms.replace("%car-dir%",_a3);return dms;},getLongitudeInDMS:function(_a5){if(!_a5){_a5="%deg%%deg-sign% %min%%min-sign% %sec%%sec-sign% %car-dir%";}var _a6="E";if(this._longitude.toString().substr(0,1)=="-"){_a6="W";}var _a7=this.toDMS(this._longitude);dms=_a5.replace("%deg%",_a7["degree"]);dms=dms.replace("%deg-sign%",this.DMS_DEG_SIGN_UTF8);dms=dms.replace("%min%",_a7["minutes"]);dms=dms.replace("%min-sign%",this.DMS_MIN_SIGN_UTF8);dms=dms.replace("%sec%",_a7["seconds"]);dms=dms.replace("%sec-sign%",this.DMS_SEC_SIGN_UTF8);dms=dms.replace("%car-dir%",_a6);return dms;},findAddress:function(){if(!this._geocoder){this._geocoder=new google.maps.Geocoder();}var _a8=new google.maps.LatLng(this._latitude,this._longitude);var _a9={"latLng":_a8};this._geocoder.geocode(_a9,dojo.hitch(this,"onAddressResult"));},findAddresses:function(){if(!this._geocoder){this._geocoder=new google.maps.Geocoder();}var _aa=new google.maps.LatLng(this._latitude,this._longitude);var _ab=new google.maps.LatLng(this._latitude+10,this._longitude+10);var _ac=new google.maps.LatLngBounds(_aa,_ab);var _ad={"bounds":_ac};console.log("GeocoderRequest [",_ad,"]");this._geocoder.geocode(_ad,dojo.hitch(this,"onAddressesResult"));},onAddressResult:function(_ae,_af){},onAddressesResult:function(_b0,_b1){}});}if(!dojo._hasResource["svzsolutions.layer"]){dojo._hasResource["svzsolutions.layer"]=true;dojo.provide("svzsolutions.layer");}
